<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini APK Builder</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<style>
  body { font-family:'Roboto',sans-serif; margin:0; padding:0; background:#1e1e1e; color:#fff; display:flex; flex-direction:column; align-items:center;}
  header {width:100%; text-align:center; background:#242424; padding:20px;}
  h1{margin:0;font-size:24px;}
  .tabs {display:flex; margin-top:10px;}
  .tab {padding:10px 20px; cursor:pointer; border-bottom:2px solid transparent; margin-right:5px;}
  .tab.active{border-bottom:3px solid #007acc; font-weight:bold;}
  .editor-box{width:90%; max-width:1200px; height:400px; border:1px solid #333; display:none; margin-top:10px;}
  .editor-box.active{display:block;}
  .buttons{margin:20px;}
  button{padding:10px 20px; font-size:16px; background:#007acc; border:none; color:white; cursor:pointer; border-radius:5px; margin-right:10px;}
  button:hover{background:#005a9e;}
  #downloadLink{color:#00ffea; text-decoration:none; font-weight:bold; display:block; margin-top:10px;}
</style>
</head>
<body>

<header>
  <h1>Mini APK Builder</h1>
  <p>Paste XML & Java code, then click ▶️ Build App!</p>
</header>

<div class="tabs">
  <div class="tab active">MAIN.XML</div>
  <div class="tab">MAINACTIVITY.JAVA</div>
</div>

<div id="xmlEditor" class="editor-box active"></div>
<div id="javaEditor" class="editor-box"></div>

<div class="buttons">
  <button onclick="buildAPK()">▶️ Build App</button>
  <a id="downloadLink" href="#" target="_blank">Download APK (placeholder)</a>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.15.6/ace.js"></script>
<script>
  // Tab switching
  const tabs = document.querySelectorAll('.tab');
  const editors = document.querySelectorAll('.editor-box');
  tabs.forEach((tab,index)=>{
    tab.addEventListener('click',()=>{
      tabs.forEach(t=>t.classList.remove('active'));
      editors.forEach(e=>e.classList.remove('active'));
      tab.classList.add('active');
      editors[index].classList.add('active');
    });
  });

  // Initialize XML editor
  const xmlEditor = ace.edit("xmlEditor");
  xmlEditor.setTheme("ace/theme/monokai");
  xmlEditor.session.setMode("ace/mode/xml");
  xmlEditor.setOptions({fontSize:"14pt", showLineNumbers:true, tabSize:4, useSoftTabs:true, wrap:true});
  xmlEditor.setValue(`<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical">
</LinearLayout>`);

  // Initialize Java editor
  const javaEditor = ace.edit("javaEditor");
  javaEditor.setTheme("ace/theme/monokai");
  javaEditor.session.setMode("ace/mode/java");
  javaEditor.setOptions({fontSize:"14pt", showLineNumbers:true, tabSize:4, useSoftTabs:true, wrap:true});
  javaEditor.setValue(`package com.example.myapp;

import android.os.Bundle;
import androidx.appcompat.app.AppCompatActivity;

public class MainActivity extends AppCompatActivity {
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
    }
}`);

  // Build APK function (GitHub Actions + download link auto update)
  async function buildAPK(){
    const xmlCode = xmlEditor.getValue();
    const javaCode = javaEditor.getValue();

    const token = 'YOUR_GITHUB_PERSONAL_ACCESS_TOKEN';
    const repo = '<username>/MiniAPKBuilder';
    const workflow = 'build-apk.yml';

    try{
      // Trigger GitHub Actions workflow
      const res = await fetch(`https://api.github.com/repos/${repo}/actions/workflows/${workflow}/dispatches`, {
        method:'POST',
        headers:{
          'Accept':'application/vnd.github+json',
          'Authorization':`token ${token}`
        },
        body:JSON.stringify({ ref:'main', inputs:{ java_code:javaCode, xml_code:xmlCode } })
      });

      if(res.ok){
        alert("Build triggered! Waiting for APK...");

        // Poll GitHub Actions artifacts every 5 sec
        const artifactURL = `https://api.github.com/repos/${repo}/actions/artifacts`;
        const pollArtifact = async () => {
          const artifactsRes = await fetch(artifactURL,{
            headers:{'Authorization':`token ${token}`}
          });
          const data = await artifactsRes.json();
          if(data.artifacts && data.artifacts.length>0){
            const apkURL = data.artifacts[0].archive_download_url.replace('archive','download');
            const downloadLink = document.getElementById("downloadLink");
            downloadLink.href = apkURL;
            downloadLink.innerText = "Download APK ✅";
          } else {
            setTimeout(pollArtifact,5000); // retry after 5 sec
          }
        }
        pollArtifact();
      }else{
        alert("Failed to trigger build");
      }
    }catch(e){
      alert("Error: "+e.message);
    }
  }
</script>
</body>
</html>